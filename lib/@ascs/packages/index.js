!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).index=t()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function e(r,c,s,u){return new(s=s||Promise)(function(e,t){function n(e){try{o(u.next(e))}catch(e){t(e)}}function i(e){try{o(u.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,i)}o((u=u.apply(r,c||[])).next())})}function r(n,i){var o,r,c,s={label:0,sent:function(){if(1&c[0])throw c[1];return c[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,r&&(c=2&t[0]?r.return:t[0]?r.throw||((c=r.return)&&c.call(r),0):r.next)&&!(c=c.call(r,t[1])).done)return c;switch(r=0,c&&(t=[2&t[0],c.value]),t[0]){case 0:case 1:c=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,r=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(c=0<(c=s.trys).length&&c[c.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!c||t[1]>c[0]&&t[1]<c[3])){s.label=t[1];break}if(6===t[0]&&s.label<c[1]){s.label=c[1],c=t;break}if(c&&s.label<c[2]){s.label=c[2],s.ops.push(t);break}c[2]&&s.ops.pop(),s.trys.pop();continue}t=i.call(n,s)}catch(e){t=[6,e],r=0}finally{o=c=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}var n={endPoint:"192.168.2.55",port:19009,useSSL:!1,accessKey:"minio",secretKey:"minio.ascs.tech",bucketName:"city-view"},i=require("minio");function o(e){void 0===e&&(e={}),this.config=t(t({},n),e),this.Client=new i.Client({endPoint:this.config.endPoint,port:this.config.port,useSSL:this.config.useSSL,accessKey:this.config.accessKey,secretKey:this.config.secretKey})}return o.prototype.readFile=function(i){return new Promise(function(e,t){var n=new FileReader;n.addEventListener("load",function(){e(n.result)}),n.addEventListener("error",function(){t("读取文件失败")}),n.readAsDataURL(i)})},o.prototype.setBucketPolicy=function(){var e='\n        {\n            "Version": "2012-10-17",\n            "Statement": [\n                {\n                "Action": [\n                    "s3:GetBucketLocation",\n                    "s3:ListBucket"\n                ],\n                "Effect": "Allow",\n                "Principal": "*",\n                "Resource": [\n                    "arn:aws:s3:::'+this.config.bucketName+'"\n                ]\n                },\n                {\n                "Action": [\n                    "s3:GetObject"\n                ],\n                "Effect": "Allow",\n                "Principal": "*",\n                "Resource": [\n                    "arn:aws:s3:::'+this.config.bucketName+'/*"\n                ]\n                }\n            ]\n            }\n        ';return this.Client.setBucketPolicy(this.config.bucketName,e)},o.prototype.bucketExists=function(){return e(this,void 0,void 0,function(){return r(this,function(e){switch(e.label){case 0:return[4,this.Client.bucketExists(this.config.bucketName)];case 1:return e.sent()?[3,4]:[4,this.Client.makeBucket(this.config.bucketName)];case 2:return e.sent(),[4,this.setBucketPolicy()];case 3:e.sent(),e.label=4;case 4:return[2]}})})},o.prototype.getFile=function(e){var t=e.split(this.config.bucketName+"/").pop()||"",n=decodeURIComponent(t);return this.Client.getObject(this.config.bucketName,n||" ")},o.prototype.upload=function(o){return e(this,void 0,void 0,function(){var t,n,i;return r(this,function(e){switch(e.label){case 0:return[4,this.readFile(o)];case 1:if(t=e.sent(),!(n=t.split(",").pop()))throw"上传文件失败";return i=Buffer.from(n,"base64"),[4,this.bucketExists()];case 2:return e.sent(),[4,this.Client.putObject(this.config.bucketName,o.name,i)];case 3:return e.sent()?[2,this.Client.getPartialObject(this.config.bucketName,o.name,0)]:(console.error("上传图片失败，请稍后重试！"),[2])}})})},o.prototype.delete=function(){},o});
